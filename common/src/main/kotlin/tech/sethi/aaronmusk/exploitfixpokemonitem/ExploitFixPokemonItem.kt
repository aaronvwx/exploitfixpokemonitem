package tech.sethi.aaronmusk.ExploitFixPokemonItem

import com.cobblemon.mod.common.Cobblemon
import dev.architectury.event.EventResult
import dev.architectury.event.events.common.ChatEvent
import dev.architectury.event.events.common.CommandPerformEvent
import dev.architectury.event.events.common.CommandRegistrationEvent
import dev.architectury.event.events.common.LifecycleEvent
import net.minecraft.entity.Entity
import org.apache.logging.log4j.LogManager

object ExploitFixPokemonItem  {


    const val MOD_ID = "exploitfixpokemonitem"
    val LOGGER = LogManager.getLogger()
    @JvmStatic
    fun init() {
        LOGGER.info("AaronMusk's Cobblemon Exploit Fix Initialized!")

        CommandPerformEvent.EVENT.register { event ->


            val text = event.results.reader.string
            val player = event.results.context.source.player
            if (text.contains("/rtp") || text.contains("/tp") || text.contains("/back") || text.contains("/spawn")
                || text.contains("/claimlist") || text.contains("/home") || text.contains("/warp")) {
                for (pokemon in Cobblemon.storage.getParty(player!!.uuid)) {
                    if (pokemon.entity != null) {
                        pokemon.entity?.remove(Entity.RemovalReason.UNLOADED_WITH_PLAYER)
                    }
                }
            }
            EventResult.pass()
        }

    }
}